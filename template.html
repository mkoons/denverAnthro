<link rel="stylesheet" href="/static/css/ol.css" type="text/css">
<link rel="stylesheet" href="/static/vendor/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />

<script src="/static/js/ol.js" type="text/javascript"></script>
<script src="/static/js/vendor/jquery.serializeJSON.min.js" type="text/javascript"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.0/jquery.cookie.min.js" type="text/javascript"></script>
<script src="/static/vendor/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>
<script src="https://code.jquery.com/ui/1.8.1/jquery-ui.min.js" type="text/javascript"></script>

<style type="text/css">
    .ui-autocomplete {
	background-color: white;
	width: 300px;
	border: 1px solid #cfcfcf;
	list-style-type: none;
	padding-left: 0px;
    }
    label {
        font-size:16px;
    }

</style>




<div style="display:none;margin-top:15px; height:500px;" id="oldbrowser" class="row">
    <!-- Success and Error Messages for the user -->
    <div  class="col-md-8 col-md-offset-1 alert alert-info">
        <h2>
            Browser problems!
        </h2>
        <p>
            Sorry, but your browser does not support the current application.
            If you want to contribute, please, upgrade to a modern web browser
            like the open source and free alternative
            <a href="http://www.mozilla.org/en-US/firefox/new/">Firefox</a> or
            <a href="https://www.google.com/intl/en/chrome/browser/">Chrome</a>.
        </p>
    </div>
</div>
<!-- End of Row -->

<div style="margin-top:15px;">
    <div id="success" class="alert alert-success" style="display:none;">
        <strong>Well done!</strong> You have successfully submitted your transcription. Here is another to try if you wish!
    </div>
    <div id="loading" class="alert alert-info" style="display:none;">
        <img src="/static/img/loading.gif">Loading next task...
    </div>
    <div id="taskcompleted" class="alert alert-info" style="display:none;">
        <strong>The task has been completed!</strong> Thanks a lot!
    </div>
    <div id="finish" class="alert alert-success" style="display:none;">
        <h2>
            Congratulations!
        </h2>
        <p>
            You have participated in <strong>all</strong> available tasks! Thank you for your interest and help.
        </p>
        <br/>
        <img src="https://crowdfunded.micropasts.org/assets/logo-head.png" width="200" height="200"/>
        <div class="alert-actions">
            <a class="btn-default btn" href="/">Go back</a>
            <a class="btn-default btn" href="/app">or, Check other applications</a>
        </div>
    </div>

    <div id="error" class="alert alert-error" style="display:none;">
        <a class="close">X.</a>
        <strong>Error!</strong> Something went wrong, please contact the site
        administrators via the forum, Twitter, email or our Facebook page.
    </div>
</div> <!-- End Success and Error Messages for the user -->


<!--
    Task DOM for loading the Flickr Images
    It uses the class="skeleton" to identify the elements that belong to the
    task.
-->

<!-- Start Skeleton Row-->
<div class="row skeleton">

    <h1 id="start">
        Please transcribe this index card
    </h1>

    <!-- The question will be loaded here -->

    <span class="label label-info">Note</span> You can use your mouse wheel track-pad to zoom in/out the picture, as well as drag & drop to navigate in the document.

</div>

<div class="row skeleton">
</div>
<div id="questions" class="col-md-12"><!-- Start of Question and Submission DIV (column) -->

    <!-- If the user clicks this button, the saved answer will be value="yes"-->
    <form id="transcription" role="form">
    <div id="photo-link" class="row">
        <!-- Start of Photo DIV (column) -->
        <div id="imgHolder" class="col-md-8">
            <div class="btn-group">
                <a class="btn btn-info btn-sm" href="#" data-toggle="modal" data-target="#myModal"><i class="glyphicon glyphicon-eye-open"></i> Tutorial</a>
                <a class="btn btn-info btn-sm" id="imgLink" target="_blank" data-toggle="tooltip" data-placement="top" title="Opens in a new window"  href="http://community.micropasts.org/category/crowdsourcing-support"><i class="glyphicon glyphicon-book"></i> Community Help</a>
                <a id="raw" href="" class="btn btn-sm btn-info fancybox" ><i class="glyphicon glyphicon-picture"></i> Overlay</a>
                <a id="flickr" rel="tooltip" target="_blank" data-toggle="tooltip" data-placement="top" title="Opens in a new window" href="" class="btn btn-sm btn-info"><i class="icon icon-flickr"></i> View on flickr</a>
                <a id="down" rel="tooltip" data-toggle="tooltip" data-placement="top" title="Only works for compliant browsers" download="" href="" class="btn btn-sm btn-info" ><i class="glyphicon glyphicon-download"></i> Download</a>
            </div>
            <!-- The container for the zoomer -->
            <div id="imgContainer"></div>
            <div id="taskImg"></div>
        </div><!-- End of Photo DIV (columnt) -->
        <div class="col-md-4">
            <!-- Object type form control -->
            <div class="form-group">
                <label class="control-label" for="accessionNo">Accession No.</label>
                <input class="form-control" type="text" name="accessionNo" placeholder="Top left of card">
            </div>

            <div class="form-group">
                <label class="control-label" for="specimenNo">Specimen No</label>
                <input class="form-control" type="text" name="specimenNo" placeholder="Left of card">
            </div>

            <div class="form-group">
                <label class="control-label" for="fieldNo">Field No</label>
                <input class="form-control" type="text" name="fieldNo" placeholder="Left of card">
            </div>

            <div class="form-group">
                <label class="control-label" for="negativeNo">Negative No</label>
                <input class="form-control" type="text" name="negativeNo" placeholder="Left of card">
            </div>
            <div class="form-group">
                <label class="control-label" for="receivedFrom">Received From</label>
                <input class="form-control" type="text" name="receivedFrom" placeholder="Center of Card">
            </div>

        </div>

    </div>


        <div class="col-md-6">

            <div class="form-group">
                <label class="control-label" for="collectedBy">Collected By</label>
                <input class="form-control" type="text" name="collectedBy" placeholder="Center of card">
            </div>

            <div class="form-group">
                <label class="control-label" for="collectedDate">Date</label>
                <input class="form-control" type="text" name="collectedDate" placeholder="Center of card">
            </div>

            <div class="form-group">
                <label class="control-label" for="locality">Locality</label>
                <input class="form-control" type="text" name="locality" placeholder="Center of card">
            </div>

            <div class="form-group">
                <label class="control-label" for="culture">Culture</label>
                <input class="form-control" type="text" name="culture" placeholder="Center of card">
            </div>

            <div class="form-group">
                <label class="control-label" for="period">Period</label>
                <input class="form-control" type="text" name="period" placeholder="Center of card">
            </div>
        </div>


        <div class="col-md-6">


            <div class="form-group">
                <label class="control-label" for="object">Object</label>
                <textarea class="form-control" rows="6" name="object" placeholder="Center of card"></textarea>
            </div>

            <div class="form-group">
                <label class="control-label" for="specimenNo">Specimen No</label>
                <input class="form-control" type="text" name="specimenNo" placeholder="Center of card">
            </div>

            <div class="form-group">
                <label class="radio-inline" for="acquisition">Gift <input class="radio" type="radio" name="acquistion"  value="gift"></label>


                <label class="radio-inline" for="acquisition">Purchase <input class="radio" type="radio" name="acquistion"  value="purchase"></label>


                <label class="radio-inline" for="acquisition">Exchange <input class="radio" type="radio" name="acquistion"  value="exchange"></label>

            </div>

            <div class="form-group">
                <label class="control-label" for="dateReceived">Date Recieved</label>
                <input class="form-control" type="text" name="dateReceived" placeholder="Center of card">
            </div>


        </div>

        <div class="col-md-12">

            <!-- Transcriber's comments -->
            <div class="form-group">
                <label class="control-label" for="other">Transcriber's Comments</label>
                <textarea class="form-control" rows="5"  name="other" placeholder="Add here your comments, if you have any."></textarea>
            </div>

        </div>




    </form>

    <button class="btn btn-info btn-answer" value='Yes'>Submit the transcription</button>

    <!-- Feedback items for the user -->
    <p>
        You are working now on task: <span id="task-id" class="label label-warning">#</span>
    </p>
    <p>
        You have completed: <span id="done" class="label label-info"></span> tasks from
        <!-- Progress bar for the user -->
        <span id="total" class="label label-inverse"></span></p>
    <div class="progress progress-striped">
        <div id="progress" rel="tooltip" title="#" class="progress-bar" role="progressbar" style="width: 0%;"></div>
    </div>
    <!-- End of feedback row -->

</div>
<!-- End of Question and Submission DIV (column) -->

<!-- The column holding the open layers div -->



</div><!-- End of Skeleton Row -->

<!-- Modal start -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <h3 class="lead">Denver Museum of Nature & Science Anthropology Catalog Cards tutorial</h3>
            </div>

            <div id="0" class="modal-body" style="display:none">

                <p>
                    When you participate, the platform will load a scanned index card from the Denver Museum of Nature & Science (DMNS) Anthopology Department
                    (stored on the MicroPasts <a href="https://www.flickr.com/photos/micropasts/albums/72157669446657984">Flickr</a> stream).
                    Once the image has been loaded, you will be asked to transcribe the contents of each
                    card. Some of the fields are no longer needed, for example, "Former Catalog No" and "Storage or Display location." Only enter the information that is asked for in the fields below the image.
                    An example of a card is shown below.
                </p>

                <img src="https://c1.staticflickr.com/9/8119/29016371406_99ed90a08c.jpg" class="img-polaroid"
                     alt="An example of one of DMNS Anthropology Catalog Cards"/>

                <p>
                    Each index card contains similar information and we are asking you to enter this information
                    into a set of pre-defined fields. In addition to the help provided by this tutorial, you will also
                    find further hints inside the data entry boxes about where on the card the relevant information might be found.

                </p>

            </div>

            <div id="1" class="modal-body" style="display:none">

                <p>
                    Sometimes you might notice that there is some variability in the style of the index cards and
                    occasionally you might get a card that looks quite different. In such cases, please try your best
                    to fill in the requisite fields and note in the Transcriber's Comments field that you found this difficult for that
                    particular card. As we continue drawer-by-drawer through the catalog, we will look to modify the
                    input fields in response to your suggestions.
                </p>

            </div>

            <div id="2" class="modal-body" style="display:none">
                <p>
                    To find out how the project is progressing, suggest changes to this application or
                    propose new research ideas based what you have transcribed, please have a look at
                    our <a href="http://community.micropasts.org" title="Community forum">community forum</a>.
                </p>

            </div>

            <div class="modal-footer">
                <a id="prevBtn" href="#" onclick="showStep('prev')" class="btn btn-default">Previous</a>
                <a id="nextBtn" href="#" onclick="showStep('next')" class="btn btn-success">Next</a>
                <a id="startContrib" href="#" class="btn btn-primary" style="display:none"><i class="glyphicon glyphicon-thumbs-up"></i> Let's start!</a>
            </div>
        </div>
    </div>
</div>
<!-- Modal end -->
<script>
    var step = -1;
    function showStep(action) {
        $("#" + step).hide();
        if (action == 'next') {
            step = step + 1;
        }
        if (action == 'prev') {
            step = step - 1;
        }
        if (step == 0) {
            $("#prevBtn").hide();
        }
        else {
            $("#prevBtn").show();
        }

        if (step == 2 ) {
            $("#nextBtn").hide();
            $("#startContrib").show();
        }
        $("#" + step).show();
    }

    showStep('next');
    $("#modal").modal('show');
</script>


<!-- The modernizer script -->

<script>
// Quick fix for IE8
Modernizr.load({
  test: window.JSON,
  nope: '/static/js/vendor/json2.min.js'
});
</script>
<!-- The main pybossa functions -->
<script>
function loadUserProgress() {
    pybossa.userProgress('DenverAnthro').done(function(data){
        console.log(data);
        console.log("Total answers done for user: " + data.done);
        
        var pct = Math.round((data.done*100)/data.total);
        $("#progress").css("width", pct.toString() +"%");
        $("#progress").attr("title", pct.toString() + "% completed!");
        $("#progress").tooltip({'placement': 'left'});
        $("#total").text(data.total);
        $("#done").text(data.done);
    });
}
</script>

<script>
pybossa.taskLoaded(function(task, deferred) {
    if ( !$.isEmptyObject(task) ) {

        // load image from flickr
        var img = $('<img />');
        img.attr("id", "img_task_" + task.id);
        img.load(function() {
            // continue as soon as the image is loaded
            deferred.resolve(task);
        });
        img.attr('src', task.info.url_b);
        img.attr('width', '50%');
        img.attr('height', '50%');
        img.addClass('img-polaroid');
        img.css("cursor", "zoom-in");
        task.info.image = img;
        }  else {
            deferred.resolve(task);
        }

});
</script>
<script>
pybossa.presentTask(function(task, deferred) {
    if ( !$.isEmptyObject(task) ) {
        loadUserProgress();
        $(':input','#transcription')
           .not(':button, :submit, :reset, :hidden, :radio')
           .val('')
           .removeAttr('checked')
           .removeAttr('selected');
        $('#imgContainer').html('').append(task.info.image);
      	$("a#raw").attr("href", task.info.url_b);
	    $("a#flickr").attr("href", task.info.link + '/sizes/k/');
	    $("a#down").attr("download", task.id);
	    $("a#down").attr("href", task.info.url_b );
        $(".fancybox").fancybox();
        $('#imgLink').tooltip();
        $("[rel=tooltip]").tooltip();
        $("#searchingTip").hide();
        $("#question").html(task.info.question);
        $('#task-id').html(task.id);
        $("#map_" + task.id).show();
        $("#img_" + task.id).show();



        $('.btn-answer').off('click').on('click', function(evt) {
            evt.preventDefault();
            var answer = $(evt.target).attr("value");
           if (typeof answer != 'undefined') {
                    task.answer = $("#transcription").serializeJSON();
                    console.log(task.answer);
                    pybossa.saveTask(task.id, task.answer).done(function() {
                        $("html, body").animate({ scrollTop: 0 }, "slow");
                        $("#success").fadeIn(500).fadeOut(500);
                        $("#loading").fadeIn(500).fadeOut(500);
                        // The line below resets the form when next loading a task
                        $('.fields').val('');
                        $('input:checkbox').removeAttr('checked');
                        deferred.resolve();
                    });
                } else {
                    $("#error").show();
                }
            });
            $("#loading").hide();
            } else {
        $(".skeleton").hide();
        $("#loading").hide();
        $("#finish").fadeIn(500);
    }
});

if(Modernizr.borderradius) {
    pybossa.run('DenverAnthro');
}
else {
    $(".skeleton").hide();
    $("#oldbrowser").show();
}
$(window).off('.affix');
$("#imgHolder")
    .removeClass("affix affix-top affix-bottom")
    .removeData("bs.affix");
</script>
