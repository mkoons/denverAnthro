<link rel="stylesheet" href="/static/css/ol.css" type="text/css">
<link rel="stylesheet" href="/static/vendor/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />

<script src="/static/js/ol.js" type="text/javascript"></script>
<script src="/static/js/vendor/jquery.serializeJSON.min.js" type="text/javascript"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.0/jquery.cookie.min.js" type="text/javascript"></script>
<script src="/static/vendor/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>
<script src="https://code.jquery.com/ui/1.8.1/jquery-ui.min.js" type="text/javascript"></script>

<style type="text/css">
    .ui-autocomplete {
	background-color: white;
	width: 300px;
	border: 1px solid #cfcfcf;
	list-style-type: none;
	padding-left: 0px;
    }
    label {
        font-size:16px;
    }

</style>




<div style="display:none;margin-top:15px; height:500px;" id="oldbrowser" class="row">
    <!-- Success and Error Messages for the user -->
    <div  class="col-md-8 col-md-offset-1 alert alert-info">
        <h2>
            Browser problems!
        </h2>
        <p>
            Sorry, but your browser does not support the current application. 
            If you want to contribute, please, upgrade to a modern web browser 
            like the open source and free alternative 
            <a href="http://www.mozilla.org/en-US/firefox/new/">Firefox</a> or 
            <a href="https://www.google.com/intl/en/chrome/browser/">Chrome</a>.
        </p>
    </div>
</div> 
<!-- End of Row -->

<div style="margin-top:15px;">
    <div id="success" class="alert alert-success" style="display:none;">
        <strong>Well done!</strong> You have successfully submitted your transcription. Here is another to try if you wish!
    </div>
    <div id="loading" class="alert alert-info" style="display:none;">
        <img src="/static/img/loading.gif">Loading next task...
    </div>
    <div id="taskcompleted" class="alert alert-info" style="display:none;">
        <strong>The task has been completed!</strong> Thanks a lot!
    </div>
    <div id="finish" class="alert alert-success" style="display:none;">
        <h2>
            Congratulations!
        </h2> 
        <p>
            You have participated in <strong>all</strong> available tasks! Thank you for your interest and help.
        </p>
        <br/>
        <img src="https://crowdfunded.micropasts.org/assets/logo-head.png" width="200" height="200"/>
        <div class="alert-actions">
            <a class="btn-default btn" href="/">Go back</a>
            <a class="btn-default btn" href="/app">or, Check other applications</a>
        </div>
    </div>

    <div id="error" class="alert alert-error" style="display:none;">
        <a class="close">X.</a>
        <strong>Error!</strong> Something went wrong, please contact the site 
        administrators via the forum, Twitter, email or our Facebook page.
    </div>
</div> <!-- End Success and Error Messages for the user -->


<!--
    Task DOM for loading the Flickr Images
    It uses the class="skeleton" to identify the elements that belong to the
    task.
-->

<!-- Start Skeleton Row-->
<div class="row skeleton"> 

        <h1 id="start">
            Please transcribe this index card
        </h1> 
    
    <!-- The question will be loaded here -->
    
    <span class="label label-info">Note</span> You can use your mouse wheel track-pad to zoom in/out the picture, as well as drag & drop to navigate in the document.

</div>

<div class="row skeleton">
 <div id="photo-link" class="row">
        <!-- Start of Photo DIV (column) -->
        <div id="imgHolder" data-spy="affix" data-offset-top="1" data-offset-bottom="550">
            <div class="btn-group">
                <a class="btn btn-info btn-sm" href="#" data-toggle="modal" data-target="#myModal"><i class="glyphicon glyphicon-eye-open"></i> Tutorial</a>
		<a class="btn btn-info btn-sm" id="imgLink" target="_blank" data-toggle="tooltip" data-placement="top" title="Opens in a new window"  href="http://community.micropasts.org/category/crowdsourcing-support"><i class="glyphicon glyphicon-book"></i> Community Help</a>
		<a id="raw" href="" class="btn btn-sm btn-info fancybox" ><i class="glyphicon glyphicon-picture"></i> Overlay</a>
	        <a id="flickr" rel="tooltip" target="_blank" data-toggle="tooltip" data-placement="top" title="Opens in a new window" href="" class="btn btn-sm btn-info"><i class="icon icon-flickr"></i> View on flickr</a>
        	<a id="down" rel="tooltip" data-toggle="tooltip" data-placement="top" title="Only works for compliant browsers" download="" href="" class="btn btn-sm btn-info" ><i class="glyphicon glyphicon-download"></i> Download</a>
            </div>
            <!-- The container for the zoomer -->
            <div id="imgContainer"></div>
            <div id="taskImg"></div>
        </div><!-- End of Photo DIV (columnt) -->
    </div>
    <div id="questions" class="col-md-4"><!-- Start of Question and Submission DIV (column) -->

        <!-- If the user clicks this button, the saved answer will be value="yes"-->
        <form id="transcription" role="form">

            <div class="col-md-4">
                <!-- Object type form control -->
                <div class="form-group">
                    <label class="control-label" for="accessionNo">Accession No.</label>
                    <input class="form-control" type="text" name="accessionNo" placeholder="Top left of card">
                </div>

                <div class="form-group">
                    <label class="control-label" for="specimenNo">Specimen No</label>
                    <input class="form-control" type="text" name="specimenNo" placeholder="Left of card">
                </div>

                 <div class="form-group">
                    <label class="control-label" for="fieldNo">Field No</label>
                    <input class="form-control" type="text" name="fieldNo" placeholder="Left of card">
                </div>

                <div class="form-group">
                <label class="control-label" for="negativeNo">Negative No</label>
                <input class="form-control" type="text" name="negativeNo" placeholder="Left of card">
            </div>

            </div>

            <div class="col-md-4">
                <div class="form-group">
                <label class="control-label" for="receivedFrom">Received From</label>
                <input class="form-control" type="text" name="receivedFrom" placeholder="Center of Card">
            </div>

             <div class="form-group">
                <label class="control-label" for="collectedBy">Collected By</label>
                <input class="form-control" type="text" name="collectedBy" placeholder="Center of card">
            </div>

             <div class="form-group">
                <label class="control-label" for="collectedDate">Date</label>
                <input class="form-control" type="text" name="collectedDate" placeholder="Center of card">
            </div>

             <div class="form-group">
                <label class="control-label" for="locality">Locality</label>
                <input class="form-control" type="text" name="locality" placeholder="Center of card">
            </div>

             <div class="form-group">
                <label class="control-label" for="culture">Culture</label>
                <input class="form-control" type="text" name="culture" placeholder="Center of card">
            </div>

             <div class="form-group">
                <label class="control-label" for="period">Period</label>
                <input class="form-control" type="text" name="period" placeholder="Center of card">
            </div>
            </div>


            <div class="col-md-4">


             <div class="form-group">
                <label class="control-label" for="object">Object</label>
                <textarea class="form-control" rows="6" name="object" placeholder="Center of card"></textarea>
            </div>

             <div class="form-group">
                <label class="control-label" for="specimenNo">Specimen No</label>
                <input class="form-control" type="text" name="specimenNo" placeholder="Center of card">
            </div>

             <div class="form-group">
                <label class="control-label" for="acquisition">Gift</label>
                <input class="form-control" type="radio" name="acquistion"  value="gift">

                 <label class="control-label" for="acquisition">Purchase</label>
                <input class="form-control" type="radio" name="acquistion"  value="purchase">

                 <label class="control-label" for="acquisition">Exchange</label>
                <input class="form-control" type="radio" name="acquistion"  value="exchange">
            </div>

             <div class="form-group">
                <label class="control-label" for="dateReceived">Date Recieved</label>
                <input class="form-control" type="text" name="dateReceived" placeholder="Center of card">
            </div>


            <!-- Transcriber's comments -->
            <div class="form-group">
                <label class="control-label" for="other">Transcriber's Comments</label>
                <textarea class="form-control" rows="5"  name="other" placeholder="Add here your comments, if you have any."></textarea>
            </div>
            </div>





        
        </form>

        <button class="btn btn-info btn-answer" value='Yes'>Submit the transcription</button>
            
	<!-- Feedback items for the user -->
        <p>
            You are working now on task: <span id="task-id" class="label label-warning">#</span>
        </p>
        <p>
            You have completed: <span id="done" class="label label-info"></span> tasks from
        <!-- Progress bar for the user -->
        <span id="total" class="label label-inverse"></span></p>
        <div class="progress progress-striped">
            <div id="progress" rel="tooltip" title="#" class="progress-bar" role="progressbar" style="width: 0%;"></div>
        </div>
	<!-- End of feedback row -->

    </div>
    <!-- End of Question and Submission DIV (column) -->
    
    <!-- The column holding the open layers div --> 
    


</div><!-- End of Skeleton Row -->

<!-- Modal start -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
	<!-- Modal header --> 
		<div class="modal-header">
                <h3 class="lead">BM Bronze Age Index DenverAnthro transcription tutorial</h3>
            </div>
	<!-- stepped modal body -->
		<div id="0" class="modal-body" style="display:none">

                <p>
                    This application is very simple, but does require you to use your own judgement in reading hand-written documents. When you participate,
                    the platform will load a scanned index card from the British Museum's Bronze Age catalogue
                    (stored on the MicroPasts <a href="http://flickr.com">Flickr</a> stream).
                    Once the image has been loaded, you will be asked to transcribe the contents of each
                    card (if a card does not load, you can still click the "View on Flickr" button to see the contents). Most scanned images combine the written details from the one side of the
                    index card and the line drawing of the object from the reverse side.
                    An example of the front side of a card is shown below.
                </p>

                <img src="https://farm4.staticflickr.com/3700/13305081014_dc91f9d867_n.jpg" class="img-polaroid"
                     alt="An example of one of the Bronze Age Index cards" width="229" height="320"/>

                <p>
                    Each index card contains similar information and we are asking you to enter this information
                    into a set of pre-defined fields. In addition to the help provided by this tutorial, you will also
                    find further hints inside the data entry boxes about where on the card the relevant information might be found
                    (e.g. in the example card above, the necessary entry for the "Object Type" filed would be "Palstave" and the data entry box
                    will hint that this information can be found "Top of card").
                </p>

            </div>

		<div id="1" class="modal-body" style="display:none">
		     <p>
                    During the transcription, you can always return to this tutorial via the "Help" button.
                    Here are some further issues to watch out for:
                    </p>

		<ol>
		
                    <li>
                    The "top right corner" field is not present on all cards, but if it exists, it is normally a typological code
                    including a Latin numeral, following by an ordinary (Arabic) number, and finally a capital letter.
                    This is often but not always written in pencil (and by the way, when the last letter is a G it often looks like a 9). The example below would be rendered "II1A":<br />
                    <img src="http://farm6.staticflickr.com/5539/12233629423_e5f1f6ddcf_o.png" class="img-polaroid" alt="Top corner" width="227" height="65"/>
                    </li>
                    
                    <li>
                    When entering information in the fields, please respect the case of words as seen on the card.
                    </li>
                    
                    <li>
                    If there is a word or a portion of a word that you cannot read, please use the "[...]" notation. For example,
                    using the example index card shown before, if you could not read the reference top left to "Sea-shore near Cooden Bay",
                    you might render it as "Sea-shore near [...] Bay", although we suggest you do fill in the whole word in cases where
                    you are fairly confident but not certain.
                    </li>

                    <li>
                    If you see text that is stacked on more than one line or separated by a gap, but that otherwise should go
                    into just one of our pre-specified boxes, then separate it by "[;]" (without any paragraph return/hitting the enter key). For example, on the
                    index card we showed you before, "Mr Vidler" and "Pevensey" are
                    both entries that should be entered in the the Collection box, so you could simply enter "Mr Vidler[;]Pevensey".
                    </li>

                    <li>
                    Measurements should be entered in millimetres or grammes, as the hints suggest, and only the number should be entered in the box
                    (e.g. a length of 174mm should  be entered as 174). If the units are not in mm or grammes, please convert them to whole number grammes and mm, and place
                    the converted values in the correct box. In such cases, please also make a note of the original in the Transcriber's Comments
                    (e.g. a length written as "4.2 in" should be note verbatim in the Transcriber's Comments, but recorded as 107 in the Length box).
                    </li>

                    <li>
                    If there is additional information on the card that you do not feel fits in one of our pre-specified
                    boxes, or if you have any further worries about how to transcribe the card, then please put these concerns in our
                    "Transcriber's Comments" box at the bottom of the transcription page.
                    </li>
                    
                </ol>


		</div>

		<div id="2" class="modal-body" style="display:none">
			<p>
	            	Sometimes you might notice that there is some variability in the style of the index cards and
	            	occasionally you might get a card that looks quite different, such as the one below. In such cases, please try your best
	            	to fill in the requisite fields and note in the Transcriber's Comments field that you found this difficult for that
	            	particular card. As we continue drawer-by-drawer through the catalog, we will look to modify the
	            	input fields in response to your suggestions.
	            	</p>
	            	<img src="https://farm4.staticflickr.com/3815/12674204253_2695e6293a_n.jpg" alt="variant card " width="230" height="320"/>
		</div>
		
		<div id="3" class="modal-body" style="display:none">
		<p>
                To find out how the project is progressing, suggest changes to this application or
                propose new research ideas based what you have transcribed, please have a look at
                our <a href="http://community.micropasts.org" title="Community forum">community forum</a>.
                </p>
		</div>

	<!-- End of stepped modal body -->

	<!-- Modal footer -->
	<div class="modal-footer">
                <a id="prevBtn" href="#" onclick="showStep('prev')" class="btn btn-default">Previous</a>
                <a id="nextBtn" href="#" onclick="showStep('next')" class="btn btn-success">Next</a>
                <button id="startContrib" data-dismiss="modal" class="btn btn-primary" style="display:none"><i class="glyphicon glyphicon-thumbs-up"></i> Let's start!</a>
            </div>
	</div>
  </div>
</div>
<!-- Modal end --> 
<script>
    var step = -1;
    function showStep(action) {
        $("#" + step).hide();
        if (action == 'next') {
            step = step + 1;
        }
        if (action == 'prev') {
            step = step - 1;
        }
        if (step == 0) {
            $("#prevBtn").hide();
        }
        else {
            $("#prevBtn").show();
        }

        if (step == 3 ) {
            $("#nextBtn").hide();
            $("#startContrib").show();
        }
        $("#" + step).show();
    }

    showStep('next');
    $("#modal").modal('show');
</script>


<!-- The modernizer script --> 

<script>
// Quick fix for IE8
Modernizr.load({
  test: window.JSON,
  nope: '/static/js/vendor/json2.min.js'
});
</script>
<!-- The main pybossa functions --> 
<script>
function loadUserProgress() {
    pybossa.userProgress('DenverAnthro').done(function(data){
        console.log(data);
        console.log("Total answers done for user: " + data.done);
        
        var pct = Math.round((data.done*100)/data.total);
        $("#progress").css("width", pct.toString() +"%");
        $("#progress").attr("title", pct.toString() + "% completed!");
        $("#progress").tooltip({'placement': 'left'});
        $("#total").text(data.total);
        $("#done").text(data.done);
    });
}
</script>

<script>
pybossa.taskLoaded(function(task, deferred) {
    if ( !$.isEmptyObject(task) ) {

        // load image from flickr
        var img = $('<img />');
        img.attr("id", "img_task_" + task.id);
        img.load(function() {
            // continue as soon as the image is loaded
            deferred.resolve(task);
        });
        img.attr('src', task.info.url_b);
        img.attr('width', '600px');
        img.attr('height', '390px');
        img.addClass('img-polaroid');
        img.css("cursor", "zoom-in");
        task.info.image = img;
        }  else {
            deferred.resolve(task);
        }

});
</script>
<script>
pybossa.presentTask(function(task, deferred) {
    if ( !$.isEmptyObject(task) ) {
        loadUserProgress();
        $(':input','#transcription')
           .not(':button, :submit, :reset, :hidden, :radio')
           .val('')
           .removeAttr('checked')
           .removeAttr('selected');
      $('#photo-link').html('').append(task.info.image);
      	$("a#raw").attr("href", task.info.url_b);
	$("a#flickr").attr("href", task.info.link + '/sizes/k/');
	$("a#down").attr("download", task.id);
	$("a#down").attr("href", task.info.url_b );
        $(".fancybox").fancybox();
        $('#imgLink').tooltip();
        $("[rel=tooltip]").tooltip();
        $("#searchingTip").hide();
        $("#question").html(task.info.question);
        $('#task-id').html(task.id);
        $("#map_" + task.id).show();
        $("#img_" + task.id).show();

        // Clean
        $('select[name=dateDiscoveryYear]').html('').append($('<option/>').val('None').html('Year'));
        for (i = 1700; i < 2000; i++) {
            $('select[name=dateDiscoveryYear]').append($('<option />').val(i).html(i));
        }

        $('select[name=dateDiscoveryMonth]').html('').append($('<option/>').val('None').html('Month'));
        for (i = 1; i <= 12; i++)  {
            $('select[name=dateDiscoveryMonth]').append($('<option />').val(i).html(i));
        }

        $('select[name=dateDiscoveryDay]').html('').append($('<option/>').val('None').html('Day'));
        for (i = 1; i <= 31; i++) {
            $('select[name=dateDiscoveryDay]').append($('<option />').val(i).html(i));
        }

        $('.btn-answer').off('click').on('click', function(evt) {
            evt.preventDefault();
            var answer = $(evt.target).attr("value");
            if (typeof answer !== 'undefined') {
                console.log(answer);
                if (answer === 'search') {
                    $("#searching").show();
                    search(task, $("#toSearch").val(), 15);
                } else {
                    task.answer = $("#transcription").serializeJSON();
                    console.log(task.answer);
                   if($('#lon').val()) {
                   var geojson = {
                       "geometry": {
                            "type": "Point",
                            "coordinates": [
                                        $('#lon').val(),
                                        $('#lat').val()
                                ]
                        },
                        "crs": {
                          "type": "name",
                          "properties": {
                            "name": "urn:ogc:def:crs:OGC:1.3:CRS84"
                          }
                        },
                        "type": "Feature",
                        "properties": {

                        }
                   };
                   console.log(geojson);
                    task.answer.geojson = geojson;
                }
                    task.answer.toSearch = task.answer.toSearch.replace(/\n/g,', ');
                    task.answer.site = task.answer.site.replace(/\r\n/g,', ');
                    console.log(task.answer);
                    
                    pybossa.saveTask(task.id, task.answer).done(function() {
                        $("#map_" + task.id).hide();
                        $("#img_" + task.id).hide();
                        //$('#img_task_' + task.id).trigger('wheelzoom.reset');
                        $("html, body").animate({ scrollTop: 0 }, "slow");
                        $("#success").fadeIn(500).fadeOut(5500);
                        $("#loading").fadeIn(500).fadeOut(1000);
                        deferred.resolve();
                    });
                    $("#loading").fadeIn(500);
                    
                }
            } else {
                console.log(answer);
                console.log(typeof(answer));
                $("#error").show();
            }
        });
        $("#loading").hide();
    }
    else {
        $(".skeleton").hide();
        $("#loading").hide();
        $("#finish").fadeIn(500);
    }
});

if(Modernizr.borderradius) {
    pybossa.run('DenverAnthro');
}
else {
    $(".skeleton").hide();
    $("#oldbrowser").show();
}
$(window).off('.affix');
$("#imgHolder")
    .removeClass("affix affix-top affix-bottom")
    .removeData("bs.affix");
</script>
